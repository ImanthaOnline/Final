<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="../static/css/view.css" rel="stylesheet">
    <style>


.card {
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
  max-width: 800px;
  margin: auto;
  text-align: justify;
  font-family: arial;
    padding: 30px;
}

.title {
  color: grey;
  font-size: 18px;
}

button {
  border: none;
  outline: 0;
  display: inline-block;
  padding: 8px;
  color: white;
  background-color: #000;
  text-align: center;
  cursor: pointer;
  width: 80%;
  font-size: 18px;
    margin-left:10% ;
}

a {
  text-decoration: none;
  font-size: 22px;
  color: black;
}

button:hover, a:hover {
  opacity: 0.7;
}

.booth{
    width: 500px;
    background-color: #ccc;
    border:10px solid #ddd;
    margin:0 auto;
    margin-bottom: 5%;


}
.booth-capture-button{
    display: block;
    margin: 10px 0;
    padding: 10px 20px;
    background-color: cornflowerblue;
    color: #fff;
    text-align: center;
    text-decoration: none;
}
#canvas{
    display: none;
}


.dark-row{
    background:#AEC5E8;

}
.light-row{

    background:#F1F3F0;
}

.details{

    margin-left: 20%;

}
.container. h2{

    margin-left:500px;
}

        .cam-view-holder {
            width: 80%;
            height:40%;
            margin-bottom: 10px;
            margin-left:20%;
        }

        #cam-view {
            width: 80%;
            height: 40%;
            border: 1px solid;
        }
        #canvas {
            display: none;
        }
        .btn{
            width:300px;
            height:40px ;
            margin-left: 250px;


        }
    </style>

</head>
<body>

<h2 style="text-align:center">Criminal information</h2>

<div class="card">


            <div class="cam-view-holder">
                <video id="cam-view"></video>
                <canvas id="canvas" width="800" height="600"></canvas>
            </div>


            <div class="row">
                <div class="col-xs-8">

                </div>
                <!-- /.col -->
                <div class="col-xs-4">
                    <button id="btnSubmit" onclick="capture()" class="btn btn-primary btn-block btn-flat">Search</button>
                </div>
                <!-- /.col -->
            </div>

<div class="details">
  <h2>Nic Number </h2>
     <h2>Name </h2>
     <h2>Age </h2>
     <h2> Address</h2>
     <h2>Hair color </h2>
     <h2>Eye color</h2>
</div>

  <div style="margin: 24px 0;">

 </div>
	<div class="row">
		<div class="table-responsive table-bordered movie-table">
            <table class="table movie-table">
                  <thead>
                  <tr class= "movie-table-head">
                      <th>Crime comitted Date</th>
                      <th>Arrested Date</th>
                      <th>Details about Commit Crime</th>

                  </tr>
              </thead>
              <tbody>

                <!--row-->
                <tr class= "dark-row">
                    <td >Toy Story</td>
                    <td> <span style="color:green;">5</span> /5 </td>
                    <td>40000000000000000</td>

                </tr>
                <!--/.row-->

                <!--row-->
                <tr class="light-row">
                    <td>The Shining</td>
                    <td> <span style="color:green;">5</span> /5 </td>
                    <td>37</td>

                </tr>
                <!--/.row-->

                <!--row-->
                <tr class = "dark-row">
                    <td>Rubber</td>
                    <td> <span style="color:red;">1</span> /5 </td>
                    <td>20</td>

                </tr>
                <!--/.row-->

                <!--row-->
                <tr class="light-row">
                    <td>The Hangover</td>
                    <td> <span style="color:orange;">3</span> /5 </td>
                    <td>33</td>

                </tr>
                <!--/.row-->



              </tbody>
            </table>
            </div>
	</div>
 <h2>Crminal comited</h2>
  <form action="/search/" method="POST">

      <div class="form-group">
      <label for="date"> Crime commited Date:</label>
      <input type="date" class="form-control" id="date" placeholder="select Date" name="commitdate">
    </div>
       <div class="form-group">
      <label for="date">Arrested Date:</label>
      <input type="date" class="form-control" id="date1" placeholder="select Date" name="arrestdate">
    </div>
   <div class="form-group">
    <label for="details">Details About Crime</label>
    <textarea class="form-control" id="details" name="details" rows="7"></textarea>
       <input id="prodId" name="nic" type="hidden" value={{nic}}>
</div>

    <button type="submit" class="btn btn-primary">Submit</button>
  </form>

</div>
<script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>

<script>



    var video = document.getElementById('cam-view');
    var canvas = $('#canvas')[0];
    var context = canvas.getContext('2d');

    $(function () {

        if (navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({video: true, audio: false})
                .then(function (stream) {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(function (error) {
                    console.log(error.message);
                })
        } else {
            alert("Your browser dont support!")
        }
    });

    function b64toBlob(b64Data, contentType, sliceSize) {
    contentType = contentType || '';
    sliceSize = sliceSize || 512;

    var byteCharacters = atob(b64Data);
    var byteArrays = [];

    for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
        var slice = byteCharacters.slice(offset, offset + sliceSize);

        var byteNumbers = new Array(slice.length);
        for (var i = 0; i < slice.length; i++) {
            byteNumbers[i] = slice.charCodeAt(i);
        }

        var byteArray = new Uint8Array(byteNumbers);

        byteArrays.push(byteArray);
    }

    var blob = new Blob(byteArrays, {type: contentType});
    return blob;
}


   (function () {
    console.log('hfiehfieh');
    var video = document.getElementById('video');
    var canvas = document.getElementById('canvas');
    // var photo = document.getElementById('photo');
    var holder = document.getElementById('cam-holder');
    context = canvas.getContext('2d');

    if (navigator.mediaDevices.getUserMedia) {

        navigator.mediaDevices.getUserMedia({video: {width: 400, height: 300}, audio: false})
            .then(function (stream) {
                video.srcObject = stream;
                video.play();

            })
            .catch(function (error) {
                console.log(error.message);
            });
    }

})();

   function capture() {
       console.log("in capture image")
        context.drawImage(video, 0, 0, 800, 600);
        var imgUrl = canvas.toDataURL('image/png');
        var block = imgUrl.split(";");
        var contentType = block[0].split(":")[1];
        var fileType = contentType.split("/")[1];
        var realData = block[1].split(",")[1];
        var blob = b64toBlob(realData, contentType);

      var newForm = new FormData();
        newForm.append("img", blob, 'test.png');

        $.ajax({
        url: "/identify/",
        data: newForm,// the formData function is available in almost all new browsers.
        type: "POST",
        contentType: false,
        processData: false,
        cache: false,

        success: function (data) {
            console.log(data);
            if (data['value']==true){
                        // location.reload();
                        // sessionStorage.removeItem('nicrec');
                console.log("done success");
                    }
        },

    });
    }

</script>
</body>
</html>
